
@*CooooooooooooooooooooooooooMent!!!!!!*@

@{
    ViewBag.Title = "Index";
}

<h2>jQuery fullcalendar demo</h2>

<div id="fullcalendar"></div>


@section Scripts {
   
    
<script type="text/javascript">
    function myFunction() {
        $('#fullcalendar').fullCalendar('destroy');
        $('#fullcalendar').fullCalendar('render');
             
        var idNumber = $('#dropsterMain').val();
        
        if (idNumber.length < 10)
            var url = "http://localhost:55579//api/BookingModels";
        else
        var url = "http://localhost:55579//api/ApplicationUserBookings/" + idNumber;
                
            $.ajax({

                url: url,
                
                type: "Get",

                success: function (data) {
                    var jsonevents = [];
                    for (var i = 0; i < data.length; i++) {
                        var description = data[i].description;
                        var begin = data[i].startTime;
                        var End = data[i].endTime;
                        var ID = data[i].Id;
                        var Booker = data[i].CustomerName;
                        var bookerEmail = data[i].CustomerEmail;

                        jsonevents[i] = { "title": description, "email": bookerEmail, "start": begin, "BookedBy": Booker, "end": End, "BookingId": ID, "allDay": false };

                    }
                   
                    $('#fullcalendar').fullCalendar({
                        
                        defaultTimedEventDuration: '01:00:00',
                        header: {
                            left: 'prev,next today',
                            center: 'title',
                            right: 'month,agendaWeek,agendaDay'
                        },

                        defaultView: 'month',
                        editable: false,
                        allDaySlot: false,
                        selectable: true,
                        slotMinutes: 15,
                        defaultDate: new Date(),
                        timeFormat: {
                            agenda: 'HH:mm'
                        },

                        events: jsonevents,

                        eventClick: function (calEvent, jsEvent, view) {

                            var dateTimeStringStart = moment(calEvent.start).format("DD-MM-YYYY HH:mm:ss");
                            var dateTimeStringEnd = moment(calEvent.end).format("DD-MM-YYYY HH:mm:ss");
                            var title = calEvent.title;
                            var bookedBy = calEvent.BookedBy;
                            var bookingId = calEvent.BookingId;
                            var emailUs = calEvent.email;

                            $('#InfoDescription').html(title);
                            $('#InfoTime').html(dateTimeStringStart + " - " + dateTimeStringEnd);
                            $('#InfoEpost').html(emailUs);
                            $('#InfoBookedBy').html(bookedBy);
                            $('#InfoBookingId').html(bookingId);
                            $('#InfoDiv').modal('show');

                        },
                        dayClick: function (date, allDay, jsEvent, view) {

                            var x = date.format();
                            
                            var d = new Date(x);
                            d.setHours(d.getHours() + 1);
                                                                        
                            var view = $('#fullcalendar').fullCalendar('getView');

                            if (view.name === "month") {
                                $('#fullcalendar').fullCalendar('gotoDate', date);
                                $('#fullcalendar').fullCalendar('changeView', 'agendaDay');
                            }
                            else {

                                $('#BookingDiv').modal('show');
                                $('#TID').html(x);
                                $("#EndingTime").html(d);

                            }

                        }

                    });
                },

                error: function (msg) { alert(msg + "skit"); }
            });

        
    }
        $(document).ready(function () {
            $("#postBtn").click(function () {
                
                function addZero(i) {
                    if (i < 10) {
                        i = "0" + i;
                    }
                    return i;
                }
                
                var startingTime = $("#TID").text();
                var d = new Date(startingTime);
                var timeInAnHour = d.getFullYear() + '-' + addZero(d.getMonth() + 1) + '-' + addZero(d.getDate()) + 'T' + addZero(d.getHours() + 1) + ':' + addZero(d.getMinutes()) + ':' + addZero(d.getSeconds());
                


                var today = new Date;
                var dateToday = new Date(today);
                var timeNow = dateToday.getFullYear() + '-' + addZero(dateToday.getMonth() + 1) + '-' + addZero(dateToday.getDate()) + 'T' + addZero(dateToday.getHours()) + ':' + addZero(dateToday.getMinutes()) + ':' + addZero(dateToday.getSeconds());

                if (timeInAnHour >= timeNow) {
                    var reqBooking = {
                        CustomerEmail: $("#inputEmail").val(),
                        description: $("#inputDescription").val(),
                        ApplicationUserId: $("#dropster :selected").val(),
                        CustomerName: $("#inputName").val(),
                        //bookingTimeSlotId: 1,
                    }
                    var reqBookingSlot = {
                        StartTime: startingTime,
                        EndTime: timeInAnHour,
                    }
                   
                    $.ajax({

                        url: "http://localhost:55579/api/BookingModels",
                        type: "POST",
                        data: JSON.stringify({ BookingModel: reqBooking, BookingTimeSlotModel: reqBookingSlot }),                     
                        contentType: 'application/json; charset=utf-8',

                           success: function (data) {
                            alert("it's working! HOOAAH!");
                            location.reload();
                   
                        },

                        error: function (msg) { alert(msg + ""); }
                    });
                }
                else

                    $('#timeErrorDiv').modal('show');
            });

        });

   
</script>

<script>
     
    $(document).ready(function () {
        $.ajax({

            url: "http://localhost:55579/api/ApplicationUsers/",
            type: "Get",

            success: function (data) {

                //var result = data.UserName;
                for (var i = 0; i < data.length; i++) {
                    var result = data[i].FirstName + " " + data[i].LastName;
                    var id = data[i].Id;
                    //för bokningsfönstrets dropdownmeny
                    $('#dropster').append($('<option>', {
                        value: id,
                        text: result
                    }));
                    //för huvudsidans dropdownmeny
                    $('#dropsterMain').append($('<option>', {
                        value: id,
                        text: result

                    }));

                }
            },

            error: function (msg) { alert(msg + "fel"); }
        });
    });


</script>

}
<button type="button" onclick="myFunction()" >Choose</button>

<select id="dropsterMain">
    <option value="test1">All</option>   
</select>

@*<button onclick="location.href='@Url.Action("Index", "Home")';return false;">Choose employee</button>*@

<!-- Modal -->
<div id="BookingDiv" class="modal fade" role="dialog" >
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Booking</h4>
            </div>
            <div class="modal-body">
                <form>
                    Deliverer
                    <br>
                    <select id="dropster">                  
                    </select>
                    <br>
                    <br>
                    Starting Time:
                    <br>
                    <label id="TID"></label>
                    <br>
                    Ending Time:
                    <br>                    
                    <label id="EndingTime"></label>
                    <br>
                    Name:                    
                    <br>
                    <input type="text" id="inputName" name="Namn">
                    <br>
                    E-mail:                    
                    <br>
                    <input type="text" id="inputEmail" description="Beskrivning">
                    <br>
                    Description:                    
                    <br>
                    <input type="text" id="inputDescription" description="Beskrivning">
                    <br>
                   
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" id="postBtn" class="btn btn-default" data-dismiss="modal">Book</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Back</button>

            </div>
        </div>

    </div>
</div>

<!-- Modal -->
<div id="InfoDiv" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Booking info</h4>
            </div>
            <div class="modal-body">
                <form>

                    Booking Id:
                    <br>
                    <label id="InfoBookingId"></label>
                    <br>
                    Time: 
                    <br>                   
                    <label id="InfoTime"></label>
                    <br>
                    Customer Name:
                    <br>
                    <label id="InfoBookedBy"></label>
                    <br>
                    Customer E-mail:
                    <br>
                    <label id="InfoEpost"></label>
                    <br>
                    Description:
                    <br>
                    <label id="InfoDescription"></label>
                    <br>

                </form>

            </div>
            <div class="modal-footer">

                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>

<div id="timeErrorDiv" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Error</h4>
            </div>
            <div class="modal-body">
                <br/>
               <h4>Please select a valid date for your reservation</h4>
                <br/>
                <br/>

           </div>
            </div>
        </div>
</div>





